

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  
  <link rel="stylesheet" href="../_static/fonts/font-awesome.css"/>

  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GB6F0LBZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-K7GB6F0LBZ');
</script>
  
  
    <title>Supporting DELETE and UPDATE &#8212; Presto 0.286 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Types" href="types.html" />
    <link rel="prev" title="Example HTTP Connector" href="example-http.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#develop/delete-and-update" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.286 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/logo.png" height="26"
                   alt="Presto 0.286 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.286 Documentation</span>
          <span class="md-header-nav__topic"> Supporting DELETE and UPDATE </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.286 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.286 Documentation">Presto 0.286 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../plugin.html" class="md-nav__link">Plugins</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rest.html" class="md-nav__link">REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ecosystem.html" class="md-nav__link">Ecosystem</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="spi-overview.html" class="md-nav__link">SPI Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="connectors.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="example-http.html" class="md-nav__link">Example HTTP Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Supporting <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Supporting <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></a>
      
        

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/develop/delete-and-update.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/develop/delete-and-update.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#develop-delete-and-update--page-root" class="md-nav__link" data-md-state="blur">Supporting <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#delete-and-update-data-flow" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> Data Flow</a>
        </li>
        <li class="md-nav__item"><a href="#the-rowid-column-handle-abstraction" class="md-nav__link" data-md-state="blur">The rowId Column Handle Abstraction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#the-rowid-column-handle-for-delete" class="md-nav__link" data-md-state="blur">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">DELETE</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#the-rowid-column-handle-for-update" class="md-nav__link" data-md-state="blur">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#updatablepagesource-api" class="md-nav__link" data-md-state="blur">UpdatablePageSource API</a>
        </li>
        <li class="md-nav__item"><a href="#connectormetadata-delete-api" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> API</a>
        </li>
        <li class="md-nav__item"><a href="#connectormetadata-update-api" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> API</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="types.html" class="md-nav__link">Types</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="functions.html" class="md-nav__link">Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="system-access-control.html" class="md-nav__link">System Access Control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="password-authenticator.html" class="md-nav__link">Password Authenticator</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="event-listener.html" class="md-nav__link">Event Listener</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="client-protocol.html" class="md-nav__link">Presto Client REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="worker-protocol.html" class="md-nav__link">Presto Worker REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="serialized-page.html" class="md-nav__link">SerializedPage Wire Format</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="presto-native.html" class="md-nav__link">Presto Native - Prestissimo</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/develop/delete-and-update.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/develop/delete-and-update.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#develop-delete-and-update--page-root" class="md-nav__link" data-md-state="blur">Supporting <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#delete-and-update-data-flow" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> Data Flow</a>
        </li>
        <li class="md-nav__item"><a href="#the-rowid-column-handle-abstraction" class="md-nav__link" data-md-state="blur">The rowId Column Handle Abstraction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#the-rowid-column-handle-for-delete" class="md-nav__link" data-md-state="blur">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">DELETE</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#the-rowid-column-handle-for-update" class="md-nav__link" data-md-state="blur">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#updatablepagesource-api" class="md-nav__link" data-md-state="blur">UpdatablePageSource API</a>
        </li>
        <li class="md-nav__item"><a href="#connectormetadata-delete-api" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> API</a>
        </li>
        <li class="md-nav__item"><a href="#connectormetadata-update-api" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> API</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="supporting-delete-and-update">
<h1 id="develop-delete-and-update--page-root">Supporting <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code><a class="headerlink" href="#develop-delete-and-update--page-root" title="Permalink to this heading">#</a></h1>
<p>The Presto engine provides APIs to support row-level SQL <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>.
To implement <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> or <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, a connector must:</p>
<ul class="simple">
<li><p>Layer an <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code> on top of the connector’s <code class="docutils literal notranslate"><span class="pre">ConnectorPageSource</span></code></p></li>
<li><p>Define <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> methods to get a rowId column handle</p></li>
<li><p>Start the operation using <code class="docutils literal notranslate"><span class="pre">beginUpdate()</span></code> or <code class="docutils literal notranslate"><span class="pre">beginDelete()</span></code></p></li>
<li><p>Finish the operation using <code class="docutils literal notranslate"><span class="pre">finishUpdate()</span></code> or <code class="docutils literal notranslate"><span class="pre">finishDelete()</span></code></p></li>
</ul>
<section id="delete-and-update-data-flow">
<h2 id="delete-and-update-data-flow"><code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> Data Flow<a class="headerlink" href="#delete-and-update-data-flow" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> have a similar flow:</p>
<ul class="simple">
<li><p>For each split, the connector will create an <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code> instance, layered over the
connector’s <code class="docutils literal notranslate"><span class="pre">ConnectorPageSource</span></code>, to read pages on behalf of the Presto engine, and to
write deletions or updates to the underlying data store.</p></li>
<li><p>The connector’s <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource.getNextPage()</span></code> implementation fetches the next page
from the underlying <code class="docutils literal notranslate"><span class="pre">ConnectorPageSource</span></code>, optionally reformats the page, and returns it
to the Presto engine.</p></li>
<li><p>The Presto engine performs filtering and projection on the page read, producing a page of filtered,
projected results.</p></li>
<li><p>The Presto engine passes that filtered, projected page of results to the connector’s
<code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code> <code class="docutils literal notranslate"><span class="pre">deleteRows()</span></code> or <code class="docutils literal notranslate"><span class="pre">updateRows()</span></code> method.  Those methods persist
the deletions or updates in the underlying data store.</p></li>
<li><p>When all the pages for a specific split have been processed, the Presto engine calls
<code class="docutils literal notranslate"><span class="pre">UpdatablePageSource.finish()</span></code>, which returns a <code class="docutils literal notranslate"><span class="pre">Collection&lt;Slice&gt;</span></code> of fragments
representing connector-specific information about the rows processed by the calls to
<code class="docutils literal notranslate"><span class="pre">deleteRows</span></code> or <code class="docutils literal notranslate"><span class="pre">updateRows</span></code>.</p></li>
<li><p>When all pages for all splits have been processed, the Presto engine calls <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata.finishDelete()</span></code> or
<code class="docutils literal notranslate"><span class="pre">finishUpdate</span></code>, passing a collection containing all the fragments from all the splits.  The connector
does what is required to finalize the operation, for example, committing the transaction.</p></li>
</ul>
</section>
<section id="the-rowid-column-handle-abstraction">
<h2 id="the-rowid-column-handle-abstraction">The rowId Column Handle Abstraction<a class="headerlink" href="#the-rowid-column-handle-abstraction" title="Permalink to this heading">#</a></h2>
<p>The Presto engine and connectors use a rowId column handle abstraction to agree on the identities of rows
to be updated or deleted.  The rowId column handle is opaque to the Presto engine.  Depending on the connector,
the rowId column handle abstraction could represent several physical columns.</p>
<section id="the-rowid-column-handle-for-delete">
<h3 id="the-rowid-column-handle-for-delete">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">DELETE</span></code><a class="headerlink" href="#the-rowid-column-handle-for-delete" title="Permalink to this heading">#</a></h3>
<p>The Presto engine identifies the rows to be deleted using a connector-specific
rowId column handle, returned by the connector’s <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata.getDeleteRowIdColumnHandle()</span></code>
method, whose full signature is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ColumnHandle</span><span class="w"> </span><span class="n">getDeleteRowIdColumnHandle</span><span class="p">(</span>
<span class="w">    </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">    </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-rowid-column-handle-for-update">
<h3 id="the-rowid-column-handle-for-update">The rowId Column Handle for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code><a class="headerlink" href="#the-rowid-column-handle-for-update" title="Permalink to this heading">#</a></h3>
<p>The Presto engine identifies rows to be updated using a connector-specific rowId column handle,
returned by the connector’s <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata.getUpdateRowIdColumnHandle()</span></code>
method.  In addition to the columns that identify the row, for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> the rowId column will contain
any columns that the connector requires in order to perform the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operation.</p>
</section>
</section>
<section id="updatablepagesource-api">
<h2 id="updatablepagesource-api">UpdatablePageSource API<a class="headerlink" href="#updatablepagesource-api" title="Permalink to this heading">#</a></h2>
<p>As mentioned above, to support <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> or <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, the connector must define a subclass of
<code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code>, layered over the connector’s <code class="docutils literal notranslate"><span class="pre">ConnectorPageSource</span></code>.  The interesting methods are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Page</span> <span class="pre">getNextPage()</span></code>.  When the Presto engine calls <code class="docutils literal notranslate"><span class="pre">getNextPage()</span></code>, the <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code> calls
its underlying <code class="docutils literal notranslate"><span class="pre">ConnectorPageSource.getNextPage()</span></code> method to get a page.  Some connectors will reformat
the page before returning it to the Presto engine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">deleteRows(Block</span> <span class="pre">rowIds)</span></code>.  The Presto engine calls the <code class="docutils literal notranslate"><span class="pre">deleteRows()</span></code> method of the same <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code>
instance that supplied the original page,  passing a block of rowIds, created by the Presto engine based on the column
handle returned by <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata.getDeleteRowIdColumnHandle()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">updateRows(Page</span> <span class="pre">page,</span> <span class="pre">List&lt;Integer&gt;</span> <span class="pre">columnValueAndRowIdChannels)</span></code>.  The Presto engine calls the <code class="docutils literal notranslate"><span class="pre">updateRows()</span></code>
method of the same <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource</span></code> instance that supplied the original page, passing a page of projected columns,
one for each updated column and the last one for the rowId column.  The order of projected columns is defined by the Presto engine,
and that order is reflected in the <code class="docutils literal notranslate"><span class="pre">columnValueAndRowIdChannels</span></code> argument.  The job of <code class="docutils literal notranslate"><span class="pre">updateRows()</span></code> is to:</p>
<ul>
<li><p>Extract the updated column blocks and the rowId block from the projected page.</p></li>
<li><p>Assemble them in whatever order is required by the connector for storage.</p></li>
<li><p>Store the update result in the underlying file store.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CompletableFuture&lt;Collection&lt;Slice&gt;&gt;</span> <span class="pre">finish()</span></code>.  The Presto engine calls <code class="docutils literal notranslate"><span class="pre">finish()</span></code> when all the pages
of a split have been processed.  The connector returns a future containing a collection of <code class="docutils literal notranslate"><span class="pre">Slice</span></code>, representing
connector-specific information about the rows processed.  Usually this will include the row count, and might
include information like the files or partitions created or changed.</p></li>
</ul>
</section>
<section id="connectormetadata-delete-api">
<h2 id="connectormetadata-delete-api"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> API<a class="headerlink" href="#connectormetadata-delete-api" title="Permalink to this heading">#</a></h2>
<p>A connector implementing <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> must specify three <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> methods.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getDeleteRowIdColumnHandle()</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ColumnHandle</span><span class="w"> </span><span class="n">getDeleteRowIdColumnHandle</span><span class="p">(</span>
<span class="w">     </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">     </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">)</span>
</pre></div>
</div>
<p>The ColumnHandle returned by this method provides the rowId column handle used by the connector to identify rows
to be deleted, as well as any other fields of the row that the connector will need to complete the <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> operation.
For a JDBC connector, that rowId is usually the primary key for the table and no other fields are required.
For other connectors, the information needed to identify a row usually consists of multiple physical columns.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">beginDelete()</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">beginDelete</span><span class="p">(</span>
<span class="w">     </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">     </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">)</span>
</pre></div>
</div>
<p>As the last step in creating the <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> execution plan, the connector’s <code class="docutils literal notranslate"><span class="pre">beginDelete()</span></code> method is called,
passing the <code class="docutils literal notranslate"><span class="pre">session</span></code> and <code class="docutils literal notranslate"><span class="pre">tableHandle</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">beginDelete()</span></code> performs any orchestration needed in the connector to start processing the <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>.
This orchestration varies from connector to connector.</p>
<p><code class="docutils literal notranslate"><span class="pre">beginDelete()</span></code> returns a <code class="docutils literal notranslate"><span class="pre">ConnectorTableHandle</span></code> with any added information the connector needs when the handle
is passed back to <code class="docutils literal notranslate"><span class="pre">finishDelete()</span></code> and the split generation machinery.  For most connectors, the returned table
handle contains a flag identifying the table handle as a table handle for a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> operation.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">finishDelete()</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">void</span><span class="w"> </span><span class="n">finishDelete</span><span class="p">(</span>
<span class="w">    </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">    </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">,</span>
<span class="w">    </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Slice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span>
</pre></div>
</div>
<p>During <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> processing, the Presto engine accumulates the <code class="docutils literal notranslate"><span class="pre">Slice</span></code> collections returned by <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource.finish()</span></code>.
After all splits have been processed, the engine calls <code class="docutils literal notranslate"><span class="pre">finishDelete()</span></code>, passing the table handle and that
collection of <code class="docutils literal notranslate"><span class="pre">Slice</span></code> fragments.  In response, the connector takes appropriate actions to complete the <code class="docutils literal notranslate"><span class="pre">Delete</span></code> operation.
Those actions might include committing the transaction, assuming the connector supports a transaction paradigm.</p>
</li>
</ul>
</section>
<section id="connectormetadata-update-api">
<h2 id="connectormetadata-update-api"><code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> API<a class="headerlink" href="#connectormetadata-update-api" title="Permalink to this heading">#</a></h2>
<p>A connector implementing <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> must specify three <code class="docutils literal notranslate"><span class="pre">ConnectorMetadata</span></code> methods.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getUpdateRowIdColumnHandle</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ColumnHandle</span><span class="w"> </span><span class="n">getUpdateRowIdColumnHandle</span><span class="p">(</span>
<span class="w">     </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">     </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">,</span>
<span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updatedColumns</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">updatedColumns</span></code> list contains column handles for all columns updated by the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operation in table column order.</p>
<p>The ColumnHandle returned by this method provides the rowId used by the connector to identify rows to be updated, as
well as any other fields of the row that the connector will need to complete the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operation.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">beginUpdate</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">beginUpdate</span><span class="p">(</span>
<span class="w">     </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">     </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">,</span>
<span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnHandle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updatedColumns</span><span class="p">)</span>
</pre></div>
</div>
<p>As the last step in creating the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> execution plan, the connector’s <code class="docutils literal notranslate"><span class="pre">beginUpdate()</span></code> method is called,
passing arguments that define the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> to the connector.  In addition to the <code class="docutils literal notranslate"><span class="pre">session</span></code>
and <code class="docutils literal notranslate"><span class="pre">tableHandle</span></code>, the arguments includes the list of the updated columns handles, in table column order.</p>
<p><code class="docutils literal notranslate"><span class="pre">beginUpdate()</span></code> performs any orchestration needed in the connector to start processing the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>.
This orchestration varies from connector to connector.</p>
<p><code class="docutils literal notranslate"><span class="pre">beginUpdate</span></code> returns a <code class="docutils literal notranslate"><span class="pre">ConnectorTableHandle</span></code> with any added information the connector needs when the handle
is passed back to <code class="docutils literal notranslate"><span class="pre">finishUpdate()</span></code> and the split generation machinery.  For most connectors, the returned table
handle contains a flag identifying the table handle as a table handle for a <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operation.  For some connectors
that support partitioning, the table handle will reflect that partitioning.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">finishUpdate</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">void</span><span class="w"> </span><span class="n">finishUpdate</span><span class="p">(</span>
<span class="w">    </span><span class="n">ConnectorSession</span><span class="w"> </span><span class="k">session</span><span class="p">,</span>
<span class="w">    </span><span class="n">ConnectorTableHandle</span><span class="w"> </span><span class="n">tableHandle</span><span class="p">,</span>
<span class="w">    </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Slice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fragments</span><span class="p">)</span>
</pre></div>
</div>
<p>During <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> processing, the Presto engine accumulates the <code class="docutils literal notranslate"><span class="pre">Slice</span></code> collections returned by <code class="docutils literal notranslate"><span class="pre">UpdatablePageSource.finish()</span></code>.
After all splits have been processed, the engine calls <code class="docutils literal notranslate"><span class="pre">finishUpdate()</span></code>, passing the table handle and that
collection of <code class="docutils literal notranslate"><span class="pre">Slice</span></code> fragments.  In response, the connector takes appropriate actions to complete the <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operation.
Those actions might include committing the transaction, assuming the connector supports a transaction paradigm.</p>
</li>
</ul>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="example-http.html" title="Example HTTP Connector"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Example HTTP Connector </span>
              </div>
            </a>
          
          
            <a href="types.html" title="Types"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Types </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>