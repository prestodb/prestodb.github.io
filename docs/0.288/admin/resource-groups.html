
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  
  <link rel="stylesheet" href="../_static/fonts/font-awesome.css"/>

  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GB6F0LBZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-K7GB6F0LBZ');
</script>
  
  
    <title>Resource Groups &#8212; Presto 0.288 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css?v=880aad8f" />
    <script src="../_static/documentation_options.js?v=cb86531f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=ff8fa330"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Session Property Managers" href="session-property-managers.html" />
    <link rel="prev" title="CTE Materialization" href="cte-materialization.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#admin/resource-groups" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.288 Documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.288 Documentation</span>
          <span class="md-header-nav__topic"> Resource Groups </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.288 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.288 Documentation">Presto 0.288 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../clients.html" class="md-nav__link">Presto Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="web-interface.html" class="md-nav__link">Web Interface</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tuning.html" class="md-nav__link">Tuning Presto</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="properties.html" class="md-nav__link">Properties Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="spill.html" class="md-nav__link">Spill to Disk</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="exchange-materialization.html" class="md-nav__link">Exchange Materialization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cte-materialization.html" class="md-nav__link">CTE Materialization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Resource Groups </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Resource Groups</a>
      
        

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/admin/resource-groups.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/admin/resource-groups.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-resource-groups--page-root" class="md-nav__link" data-md-state="blur">Resource Groups</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#resource-usage-limits" class="md-nav__link" data-md-state="blur">Resource Usage Limits</a>
        </li>
        <li class="md-nav__item"><a href="#resource-consumption" class="md-nav__link" data-md-state="blur">Resource Consumption</a>
        </li>
        <li class="md-nav__item"><a href="#sub-groups-and-query-acceptance" class="md-nav__link" data-md-state="blur">Sub-Groups and Query Acceptance</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#file-based-resource-management" class="md-nav__link" data-md-state="blur">File-Based Resource Management</a>
        </li>
        <li class="md-nav__item"><a href="#database-based-resource-management" class="md-nav__link" data-md-state="blur">Database-Based Resource Management</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#file-resource-group-manager" class="md-nav__link" data-md-state="blur">File Resource Group Manager</a>
        </li>
        <li class="md-nav__item"><a href="#database-resource-group-manager" class="md-nav__link" data-md-state="blur">Database Resource Group Manager</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#database-resource-group-manager-properties" class="md-nav__link" data-md-state="blur">Database Resource Group Manager Properties</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#resource-group-properties" class="md-nav__link" data-md-state="blur">Resource Group Properties</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#scheduling-weight-example" class="md-nav__link" data-md-state="blur">Scheduling Weight Example</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#selector-rules" class="md-nav__link" data-md-state="blur">Selector Rules</a>
        </li>
        <li class="md-nav__item"><a href="#global-properties" class="md-nav__link" data-md-state="blur">Global Properties</a>
        </li>
        <li class="md-nav__item"><a href="#providing-selector-properties" class="md-nav__link" data-md-state="blur">Providing Selector Properties</a>
        </li>
        <li class="md-nav__item"><a href="#example" class="md-nav__link" data-md-state="blur">Example</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id2" class="md-nav__link" data-md-state="blur">File Resource Group Manager</a>
        </li>
        <li class="md-nav__item"><a href="#id3" class="md-nav__link" data-md-state="blur">Database Resource Group Manager</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session-property-managers.html" class="md-nav__link">Session Property Managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="function-namespace-managers.html" class="md-nav__link">Function Namespace Managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dist-sort.html" class="md-nav__link">Distributed sort</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="verifier.html" class="md-nav__link">Presto Verifier</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../plugin.html" class="md-nav__link">Plugins</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rest.html" class="md-nav__link">REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ecosystem.html" class="md-nav__link">Ecosystem</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../presto-cpp.html" class="md-nav__link">Presto C++</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/admin/resource-groups.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/admin/resource-groups.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-resource-groups--page-root" class="md-nav__link" data-md-state="blur">Resource Groups</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#resource-usage-limits" class="md-nav__link" data-md-state="blur">Resource Usage Limits</a>
        </li>
        <li class="md-nav__item"><a href="#resource-consumption" class="md-nav__link" data-md-state="blur">Resource Consumption</a>
        </li>
        <li class="md-nav__item"><a href="#sub-groups-and-query-acceptance" class="md-nav__link" data-md-state="blur">Sub-Groups and Query Acceptance</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#file-based-resource-management" class="md-nav__link" data-md-state="blur">File-Based Resource Management</a>
        </li>
        <li class="md-nav__item"><a href="#database-based-resource-management" class="md-nav__link" data-md-state="blur">Database-Based Resource Management</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#file-resource-group-manager" class="md-nav__link" data-md-state="blur">File Resource Group Manager</a>
        </li>
        <li class="md-nav__item"><a href="#database-resource-group-manager" class="md-nav__link" data-md-state="blur">Database Resource Group Manager</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#database-resource-group-manager-properties" class="md-nav__link" data-md-state="blur">Database Resource Group Manager Properties</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#resource-group-properties" class="md-nav__link" data-md-state="blur">Resource Group Properties</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#scheduling-weight-example" class="md-nav__link" data-md-state="blur">Scheduling Weight Example</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#selector-rules" class="md-nav__link" data-md-state="blur">Selector Rules</a>
        </li>
        <li class="md-nav__item"><a href="#global-properties" class="md-nav__link" data-md-state="blur">Global Properties</a>
        </li>
        <li class="md-nav__item"><a href="#providing-selector-properties" class="md-nav__link" data-md-state="blur">Providing Selector Properties</a>
        </li>
        <li class="md-nav__item"><a href="#example" class="md-nav__link" data-md-state="blur">Example</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id2" class="md-nav__link" data-md-state="blur">File Resource Group Manager</a>
        </li>
        <li class="md-nav__item"><a href="#id3" class="md-nav__link" data-md-state="blur">Database Resource Group Manager</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="resource-groups">
<h1 id="admin-resource-groups--page-root">Resource Groups<a class="headerlink" href="#admin-resource-groups--page-root" title="Link to this heading">¶</a></h1>
<p>Resource groups place limits on resource usage, and can enforce queueing policies on
queries that run within them or divide their resources among sub-groups. A query
belongs to a single resource group, and consumes resources from that group (and its ancestors).
Except for the limit on queued queries, when a resource group runs out of a resource
it does not cause running queries to fail; instead new queries become queued.
A resource group may have sub-groups or may accept queries, but may not do both.</p>
<p>In PrestoDB, Resource Groups are a powerful tool for managing query execution and resource allocation.
They allow administrators to control how resources are allocated and utilized on a Presto cluster.</p>
<section id="resource-usage-limits">
<h2 id="resource-usage-limits">Resource Usage Limits<a class="headerlink" href="#resource-usage-limits" title="Link to this heading">¶</a></h2>
<p>Resource Groups can set limits on resource usage, such as CPU time, memory usage, or total
number of queries. This is particularly useful in multi-tenant environments where you want to ensure that no single user
or query monopolizes the system resources.</p>
</section>
<section id="resource-consumption">
<h2 id="resource-consumption">Resource Consumption<a class="headerlink" href="#resource-consumption" title="Link to this heading">¶</a></h2>
<p>A query belongs to a single resource group, and it consumes resources from that group,
as well as its parent groups. If a resource group runs out of a certain resource, it does not cause running
queries to fail. Instead, new queries will be queued until resources become available again.</p>
</section>
<section id="sub-groups-and-query-acceptance">
<h2 id="sub-groups-and-query-acceptance">Sub-Groups and Query Acceptance<a class="headerlink" href="#sub-groups-and-query-acceptance" title="Link to this heading">¶</a></h2>
<p>Sub-groups allow for hierarchical resource allocation, where each sub-group can have its own resource limits and
queueing policies. A resource group that accepts queries directly is a leaf group, and it executes queries using
its allocated resources.</p>
<p>The resource groups and associated selection rules are configured by a manager, which is pluggable.
Presto resource management can be done in two ways:</p>
<section id="file-based-resource-management">
<h3 id="file-based-resource-management">File-Based Resource Management<a class="headerlink" href="#file-based-resource-management" title="Link to this heading">¶</a></h3>
<p>In a file-based resource manager, configuration information about the resource groups is stored in a JSON file.
This file contains definitions of all resource groups and the rules to select them.
The configuration file is loaded and used at the start of the Presto server.
Any changes to the file require a restart of the Presto server to take effect.</p>
</section>
<section id="database-based-resource-management">
<h3 id="database-based-resource-management">Database-Based Resource Management<a class="headerlink" href="#database-based-resource-management" title="Link to this heading">¶</a></h3>
<p>In a database-based resource manager, configuration information about the resource groups is stored in a relational
database. The database contains definitions of all resource groups and the rules to select them.
Unlike the file-based resource manager, changes to the configuration in the database take effect
immediately and do not require a restart of the Presto server.</p>
<p>Both methods have their pros and cons. File-based resource management is simpler to set up but less flexible,
while database-based resource management is more complex to set up but offers more flexibility and dynamic changes.</p>
</section>
</section>
<section id="file-resource-group-manager">
<h2 id="file-resource-group-manager">File Resource Group Manager<a class="headerlink" href="#file-resource-group-manager" title="Link to this heading">¶</a></h2>
<p>The file resource group manager in PrestoDB is a way to manage resources using a JSON configuration file.
This file contains definitions of all resource groups and rules for selecting the appropriate resource group
for a given query.</p>
<p>To set up a file-based resource group manager:</p>
<ol class="arabic">
<li><p>Create the file <code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code>.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code>, set the <code class="docutils literal notranslate"><span class="pre">resource-groups.configuration-manager</span></code> property to <code class="docutils literal notranslate"><span class="pre">file</span></code>
using the following code example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>resource-groups.configuration-manager=file
</pre></div>
</div>
</li>
<li><p>Create a JSON file in <code class="docutils literal notranslate"><span class="pre">etc</span></code> named <code class="docutils literal notranslate"><span class="pre">resource-groups.json</span></code>. This file should contain the definitions
for the resource groups. Each resource group can specify things like the maximum memory, the
maximum queued queries, and the maximum running queries.</p>
<p>For information on creating resource group definitions, see <a class="reference internal" href="#resource-group-properties">Resource Group Properties</a>.
For an example of a resource-groups.json file, see <a class="reference external" href="resource-groups.html#id2">File Resource Group Manager</a>.</p>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code>, add a line that specifies the location of the JSON file using the
following code example. Set the <code class="docutils literal notranslate"><span class="pre">resource-groups.config-file</span></code> property to <code class="docutils literal notranslate"><span class="pre">&lt;file_path&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;file_path&gt;</span></code>
is the path to the JSON file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>resource-groups.config-file=etc/resource-groups.json
</pre></div>
</div>
</li>
<li><p>Restart the Presto server. The new resource groups take effect immediately after the restart.</p></li>
</ol>
</section>
<section id="database-resource-group-manager">
<h2 id="database-resource-group-manager">Database Resource Group Manager<a class="headerlink" href="#database-resource-group-manager" title="Link to this heading">¶</a></h2>
<p>The database resource group manager in PrestoDB is a way to manage resources using a relational database.</p>
<p>To set up a database-based resource group manager:</p>
<ol class="arabic">
<li><p>Create the file <code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code>.</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">resource-groups.configuration-manager</span></code> property to <code class="docutils literal notranslate"><span class="pre">db</span></code>.</p></li>
<li><p>Set up a relational database: The database should be accessible by Presto.
It will be used to store the configurations of the resource groups.</p></li>
<li><p>Create tables for resource groups and selection rules: You need to create tables in the
database that will store the definitions of the resource groups and the rules for selecting
the appropriate resource group for a given query.</p></li>
<li><p>To specify the database in the Presto configuration, add a line in <code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code> that
specifies the JDBC URL of the database: <code class="docutils literal notranslate"><span class="pre">resource-groups.config-db-url</span> <span class="pre">=</span> <span class="pre">&lt;jdbc_url&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;jdbc_url&gt;</span></code> is the
JDBC URL of the database.</p>
<p>Note : Currently only MySQL is supported.</p>
</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">etc/resource-groups.properties</span></code> should be similar to this following example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>resource-groups.configuration-manager=db
resource-groups.config-db-url=jdbc:mysql://localhost:3306/resource_groups?user=&lt;user&gt;&amp;password=&lt;password&gt;
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;user&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;password&gt;</span></code> with the actual username and password.</p>
<p>With the Database Resource Group Manager, changes to the configuration in the database take effect immediately
and do not require a restart of the Presto server. This allows for more flexibility and
dynamic changes to the resource group configurations.</p>
<p>The resource group configuration must be populated through tables
<code class="docutils literal notranslate"><span class="pre">resource_groups_global_properties</span></code>, <code class="docutils literal notranslate"><span class="pre">resource_groups</span></code>, and <code class="docutils literal notranslate"><span class="pre">selectors</span></code>. If any of the tables
do not exist when Presto starts, they are created automatically.</p>
<p>The rules in the <code class="docutils literal notranslate"><span class="pre">selectors</span></code> table are processed in descending order of the values in the
<code class="docutils literal notranslate"><span class="pre">priority</span></code> field.</p>
<section id="database-resource-group-manager-properties">
<h3 id="database-resource-group-manager-properties">Database Resource Group Manager Properties<a class="headerlink" href="#database-resource-group-manager-properties" title="Link to this heading">¶</a></h3>
<table id="id4">
<caption><span class="caption-text">Database resource group manager properties</span><a class="headerlink" href="#id4" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 40.0%"/>
<col style="width: 50.0%"/>
<col style="width: 10.0%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">resource-groups.config-db-url</span></code></p></td>
<td><p>Database URL to load configuration from.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">resource-groups.max-refresh-interval</span></code></p></td>
<td><p>The maximum time period for which the cluster will continue to accept
queries after refresh failures, causing configuration to become stale.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1h</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">resource-groups.exact-match-selector-enabled</span></code></p></td>
<td><p>Setting this flag enables usage of an additional
<code class="docutils literal notranslate"><span class="pre">exact_match_source_selectors</span></code> table to configure resource group
selection rules defined exact name based matches for source, environment
and query type. By default, the rules are only loaded from the
<code class="docutils literal notranslate"><span class="pre">selectors</span></code> table, with a regex-based filter for <code class="docutils literal notranslate"><span class="pre">source</span></code>, among
other filters.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="resource-group-properties">
<h2 id="resource-group-properties">Resource Group Properties<a class="headerlink" href="#resource-group-properties" title="Link to this heading">¶</a></h2>
<p>Resource Groups are defined using a set of properties that determine how resources are allocated and used.
Here are the key properties that can be set for a Resource Group:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (required): The name of the resource group. This is a mandatory property.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxQueued</span></code> (required): The maximum number of queries that can be queued in the resource group.
If this limit is reached, new queries will be rejected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hardCpuLimit</span></code> (optional): maximum amount of CPU time this
group may use in a period.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">softMemoryLimit</span></code> (required): The maximum amount of memory that the resource group can use.
This can be specified in absolute terms (like “10GB”) or as a percentage of the total available
memory (like “50%”).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hardConcurrencyLimit</span></code> (required): The maximum number of queries that the resource group
can run concurrently.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">softConcurrencyLimit</span></code> (optional): The soft limit on the number of concurrent queries.
If this limit is exceeded, the scheduler will try to prevent new queries from starting,
but it won’t force running queries to stop.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">softCpuLimit</span></code> (optional): maximum amount of CPU time this
group may use in a period (see <code class="docutils literal notranslate"><span class="pre">cpuQuotaPeriod</span></code>), before a penalty is applied to
the maximum number of running queries. <code class="docutils literal notranslate"><span class="pre">hardCpuLimit</span></code> must also be specified.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schedulingPolicy</span></code> (optional): The policy that determines how queries are scheduled within the resource group.
This can be set to one of the four values <code class="docutils literal notranslate"><span class="pre">fair</span></code>, <code class="docutils literal notranslate"><span class="pre">weighted</span></code>, <code class="docutils literal notranslate"><span class="pre">weighted_fair</span></code> or <code class="docutils literal notranslate"><span class="pre">query_priority</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">fair</span></code> (default): queued queries are processed first-in-first-out, and sub-groups
must take turns starting new queries, if they have any queued.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weighted_fair</span></code>: sub-groups are selected based on their <code class="docutils literal notranslate"><span class="pre">schedulingWeight</span></code> and the number of
queries they are already running concurrently. The expected share of running queries for a
sub-group is computed based on the weights for all currently eligible sub-groups. The sub-group
with the least concurrency relative to its share is selected to start the next query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weighted</span></code>: queued queries are selected stochastically in proportion to their priority,
specified via the <code class="docutils literal notranslate"><span class="pre">query_priority</span></code> {doc} <code class="docutils literal notranslate"><span class="pre">session</span> <span class="pre">property</span> <span class="pre">&lt;/sql/set-session&gt;</span></code>. Sub groups are selected
to start new queries in proportion to their <code class="docutils literal notranslate"><span class="pre">schedulingWeight</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query_priority</span></code>: all sub-groups must also be configured with <code class="docutils literal notranslate"><span class="pre">query_priority</span></code>.
Queued queries are selected strictly according to their priority.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">schedulingWeight</span></code> (optional): The weight for the resource group when the parent group uses the <code class="docutils literal notranslate"><span class="pre">weighted</span></code>
scheduling policy. A higher weight means that the group gets a larger share of the parent group’s
resources.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jmxExport</span></code> (optional):  If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the statistics of the resource group will be exported via JMX.
Defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">perQueryLimits</span></code> (optional): specifies max resources that each query in a
resource group may consume before being killed. These limits are not inherited from parent groups.
May set three types of limits:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">executionTimeLimit</span></code> (optional): Specify an absolute value (for example, <code class="docutils literal notranslate"><span class="pre">1h</span></code>)
for the maximum time a query may take to execute.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">totalMemoryLimit</span></code> (optional): Specify an absolute value (for example, <code class="docutils literal notranslate"><span class="pre">1GB</span></code>)
for the maximum distributed memory a query may consume.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cpuTimeLimit</span></code> (optional): Specify Specify an absolute value (for example, <code class="docutils literal notranslate"><span class="pre">1h</span></code>)
for the maximum CPU time a query may use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">workerPerQueryLimit</span></code> (optional): specifies the minimum number of workers that have to
be available for each query. Intended to be used in elastic clusters where number of workers
varies over time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">subGroups</span></code> (optional): list of sub-groups. A list of sub-groups within the resource group.
Each sub-group can have its own set of properties.</p></li>
</ul>
<section id="scheduling-weight-example">
<span id="scheduleweight-example"></span><h3 id="scheduling-weight-example">Scheduling Weight Example<a class="headerlink" href="#scheduling-weight-example" title="Link to this heading">¶</a></h3>
<p>Schedule weighting is a method of assigning a priority to a resource. Sub-groups
with a higher scheduling weight are given higher priority. For example, to
ensure timely execution of scheduled pipeline queries, weight them higher than
adhoc queries.</p>
<p>Here’s an example:</p>
<p>If you have a root resource group <code class="docutils literal notranslate"><span class="pre">global</span></code> with two subgroups: <code class="docutils literal notranslate"><span class="pre">engineering</span></code> and <code class="docutils literal notranslate"><span class="pre">marketing</span></code>.
The <code class="docutils literal notranslate"><span class="pre">engineering</span></code> subgroup has a scheduling weight of 3, and the <code class="docutils literal notranslate"><span class="pre">marketing</span></code> subgroup has a
scheduling weight of 1. In this setup, the <code class="docutils literal notranslate"><span class="pre">engineering</span></code> subgroup will get 75% of the
parent group’s resources (because 3 is 75% of the total weight of 4), and the <code class="docutils literal notranslate"><span class="pre">marketing</span></code> subgroup will
get 25% of the parent group’s resources (because 1 is 25% of the total weight of 4).</p>
<p>Schedule weighting allows you to prioritize certain subgroups over others in terms of resource allocation.
In this example, queries from the <code class="docutils literal notranslate"><span class="pre">engineering</span></code> subgroup will be prioritized over queries
from the <code class="docutils literal notranslate"><span class="pre">marketing</span></code> subgroup.</p>
</section>
</section>
<section id="selector-rules">
<h2 id="selector-rules">Selector Rules<a class="headerlink" href="#selector-rules" title="Link to this heading">¶</a></h2>
<p>Here are the key components of selector rules in PrestoDB:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">group</span></code> (required): The group these queries will run in.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code> (optional): This is a regular expression that matches the user who is submitting the query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (optional): This matches the source of the query, which is typically the
application submitting the query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queryType</span></code> (optional): String to match against the type of the query submitted:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>: <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXPLAIN</span></code>: <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span></code> queries (but not <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span> <span class="pre">ANALYZE</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DESCRIBE</span></code>: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span></code>, <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">INPUT</span></code>, <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">OUTPUT</span></code>, and <code class="docutils literal notranslate"><span class="pre">SHOW</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INSERT</span></code>: <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">AS</span></code>, and <code class="docutils literal notranslate"><span class="pre">REFRESH</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>: <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code>: <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code>: <code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code> queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATA_DEFINITION</span></code>: Queries that alter/create/drop the metadata of schemas/tables/views,
and that manage prepared statements, privileges, sessions, and transactions.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">clientTags</span></code> (optional): List of tags. To match, every tag in this list must be in the list of
client-provided tags associated with the query.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">selectorResourceEstimate</span></code> (optional): Resource Group Selection based on resource estimates.</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">executionTime</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">peakMemory</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cpuTime</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">clientInfo</span></code> (optional): String to match against client info.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">principal</span></code> (optional): This is a regular expression that matches the principal who is submitting the query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schema</span></code> (optional): This matches the session schema of the query.</p></li>
</ul>
<p>Selectors are processed sequentially and the first one that matches will be used.</p>
</section>
<section id="global-properties">
<h2 id="global-properties">Global Properties<a class="headerlink" href="#global-properties" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cpuQuotaPeriod</span></code> (optional): the period in which cpu quotas are enforced.
The <code class="docutils literal notranslate"><span class="pre">cpuQuotaPeriod</span></code> is a global property often used in container-based environments to control the amount
of CPU resources that a container can use in a specified period.</p></li>
</ul>
<p>Please note that the exact implementation and naming of these properties can
vary between different container runtimes and orchestration systems.</p>
</section>
<section id="providing-selector-properties">
<h2 id="providing-selector-properties">Providing Selector Properties<a class="headerlink" href="#providing-selector-properties" title="Link to this heading">¶</a></h2>
<p>The source name can be set as follows:</p>
<ul class="simple">
<li><p>CLI: use the <code class="docutils literal notranslate"><span class="pre">--source</span></code> option.</p></li>
<li><p>JDBC driver when used in client apps: add the <code class="docutils literal notranslate"><span class="pre">source</span></code> property to the
connection configuration and set the value when using a Java application that
uses the JDBC Driver.</p></li>
<li><p>JDBC driver used with Java programs: add a property with the key <code class="docutils literal notranslate"><span class="pre">source</span></code>
and the value on the <code class="docutils literal notranslate"><span class="pre">Connection</span></code> instance as shown in <span class="xref std std-ref">the example</span>.</p></li>
</ul>
<p>Client tags can be set as follows:</p>
<ul class="simple">
<li><p>CLI: use the <code class="docutils literal notranslate"><span class="pre">--client-tags</span></code> option.</p></li>
<li><p>JDBC driver when used in client apps: add the <code class="docutils literal notranslate"><span class="pre">clientTags</span></code> property to the
connection configuration and set the value when using a Java application that
uses the JDBC Driver.</p></li>
<li><p>JDBC driver used with Java programs: add a property with the key
<code class="docutils literal notranslate"><span class="pre">clientTags</span></code> and the value on the <code class="docutils literal notranslate"><span class="pre">Connection</span></code> instance as shown in
<span class="xref std std-ref">the example</span>.</p></li>
</ul>
</section>
<section id="example">
<h2 id="example">Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<p>In the example configuration below, there are several resource groups, some of which are templates.
Templates allow administrators to construct resource group trees dynamically. For example, in
the <code class="docutils literal notranslate"><span class="pre">pipeline_${USER}</span></code> group, <code class="docutils literal notranslate"><span class="pre">${USER}</span></code> is expanded to the name of the user that submitted
the query. <code class="docutils literal notranslate"><span class="pre">${SOURCE}</span></code> is also supported, which is expanded to the source that submitted the
query. You may also use custom named variables in the <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">user</span></code> regular expressions.</p>
<p>There are four selectors, that define which queries run in which resource group:</p>
<ul>
<li><p>The first selector matches queries from <code class="docutils literal notranslate"><span class="pre">bob</span></code> and places them in the admin group.</p></li>
<li><p>The second selector matches all data definition (DDL) queries from a source name that includes <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>
and places them in the <code class="docutils literal notranslate"><span class="pre">global.data_definition</span></code> group. This could help reduce queue times for this
class of queries, since they are expected to be fast.</p></li>
<li><p>The third selector matches queries from a source name that includes <code class="docutils literal notranslate"><span class="pre">pipeline</span></code>, and places them in a
dynamically-created per-user pipeline group under the <code class="docutils literal notranslate"><span class="pre">global.pipeline</span></code> group.</p></li>
<li><p>The fourth selector matches queries that come from BI tools which have a source matching the regular
expression <code class="docutils literal notranslate"><span class="pre">jdbc#(?&lt;toolname&gt;.*)</span></code>, and have client provided tags that are a superset of <code class="docutils literal notranslate"><span class="pre">hi-pri</span></code>.
These are placed in a dynamically-created sub-group under the <code class="docutils literal notranslate"><span class="pre">global.pipeline.tools</span></code> group. The dynamic
sub-group is created based on the named variable <code class="docutils literal notranslate"><span class="pre">toolname</span></code>, which is extracted from the
regular expression for source.</p>
<p>Consider a query with a source <code class="docutils literal notranslate"><span class="pre">jdbc#powerfulbi</span></code>, user <code class="docutils literal notranslate"><span class="pre">kayla</span></code>, and
client tags <code class="docutils literal notranslate"><span class="pre">hipri</span></code> and <code class="docutils literal notranslate"><span class="pre">fast</span></code>. This query is routed to the <code class="docutils literal notranslate"><span class="pre">global.pipeline.bi-powerfulbi.kayla</span></code>
resource group.</p>
</li>
<li><p>The last selector is a catch-all, which places all queries that have not yet been matched into a per-user
adhoc group.</p></li>
</ul>
<p>Together, these selectors implement the following policy:</p>
<ul class="simple">
<li><p>The user <code class="docutils literal notranslate"><span class="pre">bob</span></code> is an admin and can run up to 50 concurrent queries.
Queries will be run based on user-provided priority.</p></li>
</ul>
<p>For the remaining users:</p>
<ul class="simple">
<li><p>No more than 100 total queries may run concurrently.</p></li>
<li><p>Up to 5 concurrent DDL queries with a source <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> can run. Queries are run in FIFO order.</p></li>
<li><p>Non-DDL queries will run under the <code class="docutils literal notranslate"><span class="pre">global.pipeline</span></code> group, with a total concurrency of 45, and a per-user
concurrency of 5. Queries are run in FIFO order.</p></li>
<li><p>For BI tools, each tool can run up to 10 concurrent queries, and each user can run up to 3. If the total demand
exceeds the limit of 10, the user with the fewest running queries gets the next concurrency slot. This policy
results in fairness when under contention.</p></li>
<li><p>All remaining queries are placed into a per-user group under <code class="docutils literal notranslate"><span class="pre">global.adhoc.other</span></code> that behaves similarly.</p></li>
</ul>
<section id="id2">
<h3 id="id2">File Resource Group Manager<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">"rootGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"global"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80%"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"schedulingPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weighted"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"jmxExport"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"subGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data_definition"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"schedulingWeight"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adhoc"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"schedulingWeight"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"subGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"other"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"schedulingWeight"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"schedulingPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weighted_fair"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"subGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${USER}"</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bi-${toolname}"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"schedulingWeight"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"schedulingPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"weighted_fair"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"subGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${USER}"</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10%"</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"80%"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"schedulingWeight"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"jmxExport"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"subGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline_${USER}"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"50%"</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">              </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"softMemoryLimit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100%"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"hardConcurrencyLimit"</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"maxQueued"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"schedulingPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"query_priority"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"jmxExport"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"selectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bob"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">".*pipeline.*"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"queryType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DATA_DEFINITION"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"global.data_definition"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">".*pipeline.*"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"global.pipeline.pipeline_${USER}"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jdbc#(?&lt;toolname&gt;.*)"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"clientTags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"hipri"</span><span class="p">],</span>
<span class="w">      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"global.adhoc.bi-${toolname}.${USER}"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"global.adhoc.other.${USER}"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"cpuQuotaPeriod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1h"</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3 id="id3">Database Resource Group Manager<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- global properties</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups_global_properties</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'cpu_quota_period'</span><span class="p">,</span><span class="w"> </span><span class="s1">'1h'</span><span class="p">);</span>

<span class="c1">-- Every row in resource_groups table indicates a resource group.</span>
<span class="c1">-- The enviroment name is 'test_environment', make sure it matches `node.environment` in your cluster.</span>
<span class="c1">-- The parent-child relationship is indicated by the ID in 'parent' column.</span>

<span class="c1">-- create a root group 'global' with NULL parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_policy</span><span class="p">,</span><span class="w"> </span><span class="n">jmx_export</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'global'</span><span class="p">,</span><span class="w"> </span><span class="s1">'80%'</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s1">'weighted'</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">);</span>

<span class="c1">-- get ID of 'global' group</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'global'</span><span class="p">;</span><span class="w">  </span><span class="c1">-- 1</span>
<span class="c1">-- create two new groups with 'global' as parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_weight</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'data_definition'</span><span class="p">,</span><span class="w"> </span><span class="s1">'10%'</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_weight</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'adhoc'</span><span class="p">,</span><span class="w"> </span><span class="s1">'10%'</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c1">-- get ID of 'adhoc' group</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'adhoc'</span><span class="p">;</span><span class="w">   </span><span class="c1">-- 3</span>
<span class="c1">-- create 'other' group with 'adhoc' as parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_weight</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_policy</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'other'</span><span class="p">,</span><span class="w"> </span><span class="s1">'10%'</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'weighted_fair'</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="c1">-- get ID of 'other' group</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'other'</span><span class="p">;</span><span class="w">  </span><span class="c1">-- 4</span>
<span class="c1">-- create '${USER}' group with 'other' as parent.</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'${USER}'</span><span class="p">,</span><span class="w"> </span><span class="s1">'10%'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="c1">-- create 'bi-${toolname}' group with 'adhoc' as parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_weight</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_policy</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'bi-${toolname}'</span><span class="p">,</span><span class="w"> </span><span class="s1">'10%'</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'weighted_fair'</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="c1">-- create 'pipeline' group with 'global' as parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_weight</span><span class="p">,</span><span class="w"> </span><span class="n">jmx_export</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'pipeline'</span><span class="p">,</span><span class="w"> </span><span class="s1">'80%'</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="c1">-- get ID of 'pipeline' group</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'pipeline'</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 7</span>
<span class="c1">-- create 'pipeline_${USER}' group with 'pipeline' as parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w">  </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'pipeline_${USER}'</span><span class="p">,</span><span class="w"> </span><span class="s1">'50%'</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>

<span class="c1">-- create a root group 'admin' with NULL parent</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">soft_memory_limit</span><span class="p">,</span><span class="w"> </span><span class="n">hard_concurrency_limit</span><span class="p">,</span><span class="w"> </span><span class="n">max_queued</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling_policy</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">jmx_export</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">'admin'</span><span class="p">,</span><span class="w"> </span><span class="s1">'100%'</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">'query_priority'</span><span class="p">,</span><span class="w"> </span><span class="s1">'test_environment'</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>


<span class="c1">-- Selectors</span>

<span class="c1">-- use ID of 'admin' resource group for selector</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">selectors</span><span class="w"> </span><span class="p">(</span><span class="n">resource_group_id</span><span class="p">,</span><span class="w"> </span><span class="n">user_regex</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'admin'</span><span class="p">),</span><span class="w"> </span><span class="s1">'bob'</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>

<span class="c1">-- use ID of 'global.data_definition' resource group for selector</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">selectors</span><span class="w"> </span><span class="p">(</span><span class="n">resource_group_id</span><span class="p">,</span><span class="w"> </span><span class="n">source_regex</span><span class="p">,</span><span class="w"> </span><span class="n">query_type</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'data_definition'</span><span class="p">),</span><span class="w"> </span><span class="s1">'.*pipeline.*'</span><span class="p">,</span><span class="w"> </span><span class="s1">'DATA_DEFINITION'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="c1">-- use ID of 'global.pipeline.pipeline_${USER}' resource group for selector</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">selectors</span><span class="w"> </span><span class="p">(</span><span class="n">resource_group_id</span><span class="p">,</span><span class="w"> </span><span class="n">source_regex</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="n">resource_group_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'pipeline_${USER}'</span><span class="p">),</span><span class="w"> </span><span class="s1">'.*pipeline.*'</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="c1">-- get ID of 'global.adhoc.other.${USER}' resource group for by disambiguating group name using parent ID</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">resource_group_id</span><span class="w"> </span><span class="n">self_id</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">resource_group_id</span><span class="w"> </span><span class="n">parent_id</span><span class="p">,</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">'.'</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="n">name_with_parent</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">resource_groups</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">resource_group_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'${USER}'</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'other'</span><span class="p">;</span>
<span class="c1">-- |       5 |         4 | other.${USER}    |</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">selectors</span><span class="w"> </span><span class="p">(</span><span class="n">resource_group_id</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="cte-materialization.html" title="CTE Materialization"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> CTE Materialization </span>
              </div>
            </a>
          
          
            <a href="session-property-managers.html" title="Session Property Managers"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Session Property Managers </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>