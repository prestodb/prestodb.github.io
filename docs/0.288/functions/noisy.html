
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  
  <link rel="stylesheet" href="../_static/fonts/font-awesome.css"/>

  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GB6F0LBZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-K7GB6F0LBZ');
</script>
  
  
    <title>Noisy Aggregate Functions &#8212; Presto 0.288 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css?v=880aad8f" />
    <script src="../_static/documentation_options.js?v=cb86531f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=ff8fa330"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Window Functions" href="window.html" />
    <link rel="prev" title="Aggregate Functions" href="aggregate.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#functions/noisy" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.288 Documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.288 Documentation</span>
          <span class="md-header-nav__topic"> Noisy Aggregate Functions </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.288 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.288 Documentation">Presto 0.288 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../clients.html" class="md-nav__link">Presto Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../plugin.html" class="md-nav__link">Plugins</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="logical.html" class="md-nav__link">Logical Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="comparison.html" class="md-nav__link">Comparison Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="conditional.html" class="md-nav__link">Conditional Expressions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="lambda.html" class="md-nav__link">Lambda Expressions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="conversion.html" class="md-nav__link">Conversion Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="math.html" class="md-nav__link">Mathematical Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="bitwise.html" class="md-nav__link">Bitwise Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="decimal.html" class="md-nav__link">Decimal Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="string.html" class="md-nav__link">String Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="regexp.html" class="md-nav__link">Regular Expression Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="binary.html" class="md-nav__link">Binary Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="json.html" class="md-nav__link">JSON Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="datetime.html" class="md-nav__link">Date and Time Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="aggregate.html" class="md-nav__link">Aggregate Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Noisy Aggregate Functions </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Noisy Aggregate Functions</a>
      
        

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/functions/noisy.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/functions/noisy.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#functions-noisy--page-root" class="md-nav__link" data-md-state="blur">Noisy Aggregate Functions</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link" data-md-state="blur">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#counts-sums-and-averages" class="md-nav__link" data-md-state="blur">Counts, Sums, and Averages</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#noisy_count_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_count_if_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_count_if_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_sum_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_sum_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_avg_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_avg_gaussian()</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#approximate-distinct-counting-sketching" class="md-nav__link" data-md-state="blur">Approximate Distinct Counting/Sketching</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#noisy_approx_set_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_approx_set_sfm_from_index_and_zeros" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm_from_index_and_zeros()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_approx_distinct_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_distinct_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_empty_approx_set_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#cardinality" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">cardinality()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#merge" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">merge()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#merge_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">merge_sfm()</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link" data-md-state="blur">Limitations</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="window.html" class="md-nav__link">Window Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="array.html" class="md-nav__link">Array Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="map.html" class="md-nav__link">Map Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="url.html" class="md-nav__link">URL Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ip.html" class="md-nav__link">IP Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="geospatial.html" class="md-nav__link">Geospatial Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hyperloglog.html" class="md-nav__link">HyperLogLog Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="khyperloglog.html" class="md-nav__link">KHyperLogLog Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="qdigest.html" class="md-nav__link">Quantile Digest Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="uuid.html" class="md-nav__link">UUID functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tdigest.html" class="md-nav__link">T-Digest Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="color.html" class="md-nav__link">Color Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session.html" class="md-nav__link">Session Information</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="teradata.html" class="md-nav__link">Teradata Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="internationalization.html" class="md-nav__link">Internationalization Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="setdigest.html" class="md-nav__link">Set Digest functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sketch.html" class="md-nav__link">Sketch Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pinot.html" class="md-nav__link">Pinot Functions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rest.html" class="md-nav__link">REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ecosystem.html" class="md-nav__link">Ecosystem</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../presto-cpp.html" class="md-nav__link">Presto C++</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/functions/noisy.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/functions/noisy.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#functions-noisy--page-root" class="md-nav__link" data-md-state="blur">Noisy Aggregate Functions</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link" data-md-state="blur">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#counts-sums-and-averages" class="md-nav__link" data-md-state="blur">Counts, Sums, and Averages</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#noisy_count_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_count_if_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_count_if_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_sum_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_sum_gaussian()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_avg_gaussian" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_avg_gaussian()</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#approximate-distinct-counting-sketching" class="md-nav__link" data-md-state="blur">Approximate Distinct Counting/Sketching</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#noisy_approx_set_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_approx_set_sfm_from_index_and_zeros" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_set_sfm_from_index_and_zeros()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_approx_distinct_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_approx_distinct_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#noisy_empty_approx_set_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#cardinality" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">cardinality()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#merge" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">merge()</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#merge_sfm" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">merge_sfm()</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link" data-md-state="blur">Limitations</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="noisy-aggregate-functions">
<h1 id="functions-noisy--page-root">Noisy Aggregate Functions<a class="headerlink" href="#functions-noisy--page-root" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id10">Overview</a></p></li>
<li><p><a class="reference internal" href="#counts-sums-and-averages" id="id11">Counts, Sums, and Averages</a></p></li>
<li><p><a class="reference internal" href="#approximate-distinct-counting-sketching" id="id12">Approximate Distinct Counting/Sketching</a></p></li>
<li><p><a class="reference internal" href="#limitations" id="id13">Limitations</a></p></li>
</ul>
</nav>
<section id="overview">
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Noisy aggregate functions are functions that provide random, noisy
approximations of common aggregations like <a class="reference internal" href="aggregate.html#sum" title="sum"><code class="xref py py-func docutils literal notranslate"><span class="pre">sum()</span></code></a>, <a class="reference internal" href="aggregate.html#id1" title="count"><code class="xref py py-func docutils literal notranslate"><span class="pre">count()</span></code></a>, and
<a class="reference internal" href="aggregate.html#id6" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a> as well as sketches like <a class="reference internal" href="hyperloglog.html#id0" title="approx_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_set()</span></code></a>. By
injecting random noise into results, noisy aggregation functions make it more
difficult to determine or confirm the exact data that was aggregated.</p>
<p>While many of these functions resemble
<a class="reference external" href="https://en.wikipedia.org/wiki/Differential_privacy">differential privacy</a>
mechanisms, neither the values returned by these functions nor the query results
that incorporate these functions are differentially private in general.
See <a class="reference internal" href="#limitations">Limitations</a> below for more details. Users who wish to support a strong
privacy guarantee should discuss with a suitable technical expert first.</p>
</section>
<section id="counts-sums-and-averages">
<h2 id="counts-sums-and-averages">Counts, Sums, and Averages<a class="headerlink" href="#counts-sums-and-averages" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_count_gaussian">
<span class="sig-name descname"><span class="pre">noisy_count_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_count_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Counts the non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed
random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code> to the true count.
The noisy count is post-processed to be non-negative and rounded to bigint.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">noisy_count_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tpch</span><span class="p">.</span><span class="n">tiny</span><span class="p">.</span><span class="n">lineitem</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 60179 (1 row)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">noisy_count_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tpch</span><span class="p">.</span><span class="n">tiny</span><span class="p">.</span><span class="n">lineitem</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">false</span><span class="p">;</span><span class="w"> </span><span class="c1">-- NULL (1 row)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="aggregate.html#id1" title="count"><code class="xref py py-func docutils literal notranslate"><span class="pre">count()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when the (true) count of <code class="docutils literal notranslate"><span class="pre">col</span></code> is 0.</p>
</div>
<p>Distinct counting can be performed using <code class="docutils literal notranslate"><span class="pre">noisy_count_gaussian(DISTINCT</span> <span class="pre">col,</span> <span class="pre">...)</span></code>, or with
<a class="reference internal" href="#noisy_approx_distinct_sfm" title="noisy_approx_distinct_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_approx_distinct_sfm()</span></code></a>. Generally speaking, <a class="reference internal" href="#noisy_count_gaussian" title="noisy_count_gaussian"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_count_gaussian()</span></code></a>
returns more accurate results but at a larger computational cost.</p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_count_if_gaussian">
<span class="sig-name descname"><span class="pre">noisy_count_if_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_count_if_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Counts the <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed random double
value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code> to the true count.
The noisy count is post-processed to be non-negative and rounded to bigint.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">noisy_count_if_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tpch</span><span class="p">.</span><span class="n">tiny</span><span class="p">.</span><span class="n">lineitem</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 50180 (1 row)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">noisy_count_if_gaussian</span><span class="p">(</span><span class="n">orderkey</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tpch</span><span class="p">.</span><span class="n">tiny</span><span class="p">.</span><span class="n">lineitem</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">false</span><span class="p">;</span><span class="w"> </span><span class="c1">-- NULL (1 row)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="aggregate.html#count_if" title="count_if"><code class="xref py py-func docutils literal notranslate"><span class="pre">count_if()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when the (true) count is 0.</p>
</div>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_sum_gaussian">
<span class="sig-name descname"><span class="pre">noisy_sum_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#noisy_sum_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the sum over the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally distributed
random double value with 0 mean and standard deviation of noise_scale. Each value is clipped to the range
of [<code class="docutils literal notranslate"><span class="pre">lower</span></code>, <code class="docutils literal notranslate"><span class="pre">upper</span></code>] before adding to the sum.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">noisy_sum_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span></dt>
<dd><p>Calculates the sum over the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds a normally
distributed random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_avg_gaussian">
<span class="sig-name descname"><span class="pre">noisy_avg_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span><a class="headerlink" href="#noisy_avg_gaussian" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the average (arithmetic mean) of all the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then
adds a normally distributed random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.
Each value is clipped to the range of [<code class="docutils literal notranslate"><span class="pre">lower</span></code>, <code class="docutils literal notranslate"><span class="pre">upper</span></code>] before averaging.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">noisy_avg_gaussian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_scale</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">double</span></span></span></dt>
<dd><p>Calculates the average (arithmetic mean) of all the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code> and then adds
a normally distributed random double value with 0 mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">noise_scale</span></code>.</p>
<p>If provided, <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is used to seed the random number generator. Otherwise,
noise is drawn from a secure random.</p>
</dd></dl>
</section>
<section id="approximate-distinct-counting-sketching">
<h2 id="approximate-distinct-counting-sketching">Approximate Distinct Counting/Sketching<a class="headerlink" href="#approximate-distinct-counting-sketching" title="Link to this heading">¶</a></h2>
<p>Noisy approximate distinct counting and sketching (analogous to the deterministic <a class="reference internal" href="hyperloglog.html"><span class="doc">HyperLogLog Functions</span></a>)
is supported via the Sketch-Flip-Merge (SFM) data sketch <a class="reference internal" href="#hehir2023" id="id1"><span>[Hehir2023]</span></a>.</p>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_set_sfm">
<span class="sig-name descname"><span class="pre">noisy_approx_set_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_approx_set_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch of the input values in <code class="docutils literal notranslate"><span class="pre">col</span></code>. This is analogous to the
<a class="reference internal" href="hyperloglog.html#id0" title="approx_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_set()</span></code></a> function, which returns a (deterministic) HyperLogLog sketch.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">col</span></code> supports many types, similar to <code class="docutils literal notranslate"><span class="pre">HyperLogLog</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in
the sketch, as described in <a class="reference internal" href="#hehir2023" id="id2"><span>[Hehir2023]</span></a>. Smaller values of epsilon correspond
to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) defaults to 4096.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="hyperloglog.html#id0" title="approx_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_set()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col</span></code> is empty.
If this behavior is undesirable, use <a class="reference internal" href="conditional.html#id2" title="coalesce"><code class="xref py py-func docutils literal notranslate"><span class="pre">coalesce()</span></code></a> with <a class="reference internal" href="#noisy_empty_approx_set_sfm" title="noisy_empty_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>.</p>
</div>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_set_sfm_from_index_and_zeros">
<span class="sig-name descname"><span class="pre">noisy_approx_set_sfm_from_index_and_zeros</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_zeros</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_approx_set_sfm_from_index_and_zeros" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch of the input values in <code class="docutils literal notranslate"><span class="pre">col_index</span></code> and <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code>.</p>
<p>This is similar to <a class="reference internal" href="#noisy_approx_set_sfm" title="noisy_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a> except that function calculates a <code class="docutils literal notranslate"><span class="pre">Murmur3Hash128.hash64()</span></code> of <code class="docutils literal notranslate"><span class="pre">col</span></code>,
and calculates the SFM PCSA bucket index and number of trailing zeros as described in
<a class="reference internal" href="#flajoletmartin1985" id="id3"><span>[FlajoletMartin1985]</span></a>. In this function, the caller must explicitly calculate the hash bucket index
and zeros themselves and pass them as arguments <code class="docutils literal notranslate"><span class="pre">col_index</span></code> and <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">col_index</span></code> (bigint) must be in the range <code class="docutils literal notranslate"><span class="pre">0..buckets-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col_zeros</span></code> (bigint) must be in the range <code class="docutils literal notranslate"><span class="pre">0..64</span></code>. If it exceeds <code class="docutils literal notranslate"><span class="pre">precision</span></code>, it
is cropped to <code class="docutils literal notranslate"><span class="pre">precision-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in
the sketch, as described in <a class="reference internal" href="#hehir2023" id="id4"><span>[Hehir2023]</span></a>. Smaller values of epsilon correspond
to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) is the number of buckets in the SFM PCSA sketch as described in <a class="reference internal" href="#hehir2023" id="id5"><span>[Hehir2023]</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like  <a class="reference internal" href="#noisy_approx_set_sfm" title="noisy_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_approx_set_sfm()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col_index</span></code>
or <code class="docutils literal notranslate"><span class="pre">col_zeros</span></code> is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.
If this behavior is undesirable, use <a class="reference internal" href="conditional.html#id2" title="coalesce"><code class="xref py py-func docutils literal notranslate"><span class="pre">coalesce()</span></code></a> with <a class="reference internal" href="#noisy_empty_approx_set_sfm" title="noisy_empty_approx_set_sfm"><code class="xref py py-func docutils literal notranslate"><span class="pre">noisy_empty_approx_set_sfm()</span></code></a>.</p>
</div>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_approx_distinct_sfm">
<span class="sig-name descname"><span class="pre">noisy_approx_distinct_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#noisy_approx_distinct_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Equivalent to <code class="docutils literal notranslate"><span class="pre">cardinality(noisy_approx_set_sfm(col,</span> <span class="pre">epsilon,</span> <span class="pre">buckets,</span> <span class="pre">precision))</span></code>,
this returns the approximate cardinality (distinct count) of the column <code class="docutils literal notranslate"><span class="pre">col</span></code>.
This is analogous to the (deterministic) <a class="reference internal" href="aggregate.html#id6" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike <a class="reference internal" href="aggregate.html#id6" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a>, this function returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when <code class="docutils literal notranslate"><span class="pre">col</span></code> is empty.</p>
</div>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="noisy_empty_approx_set_sfm">
<span class="sig-name descname"><span class="pre">noisy_empty_approx_set_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">buckets</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">precision</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#noisy_empty_approx_set_sfm" title="Link to this definition">¶</a></dt>
<dd><p>Returns an SFM sketch with no items in it. This is analogous to the <a class="reference internal" href="hyperloglog.html#id1" title="empty_approx_set"><code class="xref py py-func docutils literal notranslate"><span class="pre">empty_approx_set()</span></code></a>
function, which returns an empty (deterministic) HyperLogLog sketch.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> (double) is a positive number that controls the level of noise in the sketch,
as described in <a class="reference internal" href="#hehir2023" id="id6"><span>[Hehir2023]</span></a>. Smaller values of epsilon correspond to noisier sketches.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> (int) defaults to 4096.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precision</span></code> (int) defaults to 24.</p></li>
</ul>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="cardinality">
<span class="sig-name descname"><span class="pre">cardinality</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">SfmSketch</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">bigint</span></span></span><a class="headerlink" href="#cardinality" title="Link to this definition">¶</a></dt>
<dd><p>Returns the estimated cardinality (distinct count) of an <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> object.</p>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">SfmSketch</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#merge" title="Link to this definition">¶</a></dt>
<dd><p>An aggregator function that returns a merged <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> of the set union of
individual <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> objects, similar to <code class="docutils literal notranslate"><span class="pre">merge(HyperLogLog)</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">cardinality</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="n">sketch</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">annual_distinct_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">monthly_sketches</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="merge_sfm">
<span class="sig-name descname"><span class="pre">merge_sfm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">ARRAY[SfmSketch,</span> <span class="pre">...]</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">SfmSketch</span></span></span><a class="headerlink" href="#merge_sfm" title="Link to this definition">¶</a></dt>
<dd><p>A scalar function that returns a merged <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> of the set union of an array
of <code class="docutils literal notranslate"><span class="pre">SfmSketch</span></code> objects, similar to <a class="reference internal" href="hyperloglog.html#merge_hll" title="merge_hll"><code class="xref py py-func docutils literal notranslate"><span class="pre">merge_hll()</span></code></a>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">cardinality</span><span class="p">(</span><span class="n">merge_sfm</span><span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span>
<span class="w">    </span><span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">noisy_approx_set_sfm</span><span class="p">(</span><span class="n">col_3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>
<span class="p">]))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distinct_count_over_3_cols</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">my_table</span>
</pre></div>
</div>
</dd></dl>
</section>
<section id="limitations">
<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Link to this heading">¶</a></h2>
<p>While these functions resemble differential privacy mechanisms, the values returned
by these functions are not differentially private in general. There are several
important limitations to keep in mind if using these functions for
privacy-preserving purposes, including:</p>
<ul class="simple">
<li><p>All noisy aggregate functions return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when aggregating empty sets.
This means a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> return value noiselessly indicates the absence of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clauses used in combination with noisy aggregation functions
reveal non-noisy information: the presence or absence of a group noiselessly
indicates the presence or absence of data. See, e.g., <a class="reference internal" href="#wilkins2024" id="id7"><span>[Wilkins2024]</span></a>.</p></li>
<li><p>Functions relying on floating-point noise may be susceptible to inference
attacks such as those identified in <a class="reference internal" href="#mironov2012" id="id8"><span>[Mironov2012]</span></a> and <a class="reference internal" href="#casacuberta2022" id="id9"><span>[Casacuberta2022]</span></a>.</p></li>
</ul>
<hr class="docutils"/>
<div class="citation-list" role="list">
<div class="citation" id="casacuberta2022" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id9" role="doc-backlink">Casacuberta2022</a><span class="fn-bracket">]</span></span>
<p>Casacuberta, S., Shoemate, M., Vadhan, S., &amp; Wagaman, C.
(2022). <a class="reference external" href="https://arxiv.org/pdf/2207.10635">Widespread Underestimation of Sensitivity in Differentially Private
Libraries and How to Fix It.</a> In <em>Proceedings
of the 2022 ACM SIGSAC Conference on Computer and Communications Security</em> (pp. 471-484).</p>
</div>
<div class="citation" id="hehir2023" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Hehir2023<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a href="#id1" role="doc-backlink">1</a>,<a href="#id2" role="doc-backlink">2</a>,<a href="#id4" role="doc-backlink">3</a>,<a href="#id5" role="doc-backlink">4</a>,<a href="#id6" role="doc-backlink">5</a>)</span>
<p>Hehir, J., Ting, D., &amp; Cormode, G. (2023). <a class="reference external" href="https://proceedings.mlr.press/v202/hehir23a/hehir23a.pdf">Sketch-Flip-Merge:
Mergeable Sketches for Private Distinct Counting.</a> In <em>Proceedings of
the 40th International Conference on Machine Learning</em> (Vol. 202).</p>
</div>
<div class="citation" id="mironov2012" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id8" role="doc-backlink">Mironov2012</a><span class="fn-bracket">]</span></span>
<p>Mironov, I. (2012). <a class="reference external" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2012/10/lsbs.pdf">On significance of the least significant bits
for differential privacy.</a>
In <em>Proceedings of the 2012 ACM Conference on Computer and Communications Security</em> (pp. 650-661).</p>
</div>
<div class="citation" id="wilkins2024" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id7" role="doc-backlink">Wilkins2024</a><span class="fn-bracket">]</span></span>
<p>Wilkins, A., Kifer, D., Zhang, D., &amp; Karrer, B. (2024). <a class="reference external" href="https://journalprivacyconfidentiality.org/index.php/jpc/article/view/823/755">Exact
Privacy Analysis of the Gaussian Sparse Histogram Mechanism.</a>
<em>Journal of Privacy and Confidentiality</em>, 14 (1).</p>
</div>
<div class="citation" id="flajoletmartin1985" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a href="#id3" role="doc-backlink">FlajoletMartin1985</a><span class="fn-bracket">]</span></span>
<p>Flajolet, P, Martin, G. N. (1985). <a class="reference external" href="https://algo.inria.fr/flajolet/Publications/src/FlMa85.pdf">Probabilistic Counting Algorithms for Data Base Applications.</a>
In <em>Journal of Computer and System Sciences</em>, 31:182–209, 1985</p>
</div>
</div>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="aggregate.html" title="Aggregate Functions"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Aggregate Functions </span>
              </div>
            </a>
          
          
            <a href="window.html" title="Window Functions"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Window Functions </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>